{"version":3,"sources":["webpack:///src/app/common/payment/payment-confirmation/payment-confirmation.component.html","webpack:///src/app/common/payment/payment-confirmation/payment-confirmation.component.ts"],"names":["PaymentConfirmationComponent","modal","tokenService","session","sgpmxService","translate","scope","onConfirm","onViewTransactions","isSubmitted","isCompleted","showInvoice","calculateFee","calculateCreditableAmount","calculateDeductableAmount","faMobile","faLockAlt","faEllipsisV","faShieldAlt","appName","transaction","type","instant","value","times","toString","grantTokenScope","pipe","error","subscribe","emit","includes","currency","code","calculateFeeInUsd","selector","template"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAe;;;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UCqBFA,4BAA4B;AAAA;;AAAA;;AAsBrC,8CACIC,KADJ,EAEIC,YAFJ,EAGIC,OAHJ,EAIYC,YAJZ,EAKWC,SALX,EAKsC;AAAA;;AAAA;;AAElC,oCAAMJ,KAAN,EAAaC,YAAb,EAA2BC,OAA3B;AAHQ,gBAAAC,YAAA,GAAAA,YAAA;AACD,gBAAAC,SAAA,GAAAA,SAAA;AA1BJ,gBAAAC,KAAA,GAAQ,SAAR;AAIS,gBAAAC,SAAA,GAAY,IAAI,0DAAJ,EAAZ;AAEA,gBAAAC,kBAAA,GAAqB,IAAI,0DAAJ,EAArB;AAET,gBAAAC,WAAA,GAAc,KAAd;AACA,gBAAAC,WAAA,GAAc,KAAd;AACA,gBAAAC,WAAA,GAAc,KAAd;AAEA,gBAAAC,YAAA,GAAe,kEAAf;AACA,gBAAAC,yBAAA,GAA4B,+EAA5B;AACA,gBAAAC,yBAAA,GAA4B,+EAA5B;AACA,gBAAAC,QAAA,GAAW,yEAAX;AACA,gBAAAC,SAAA,GAAY,0EAAZ;AACA,gBAAAC,WAAA,GAAc,8EAAd;AACA,gBAAAC,WAAA,GAAc,4EAAd;AACA,gBAAAC,OAAA,GAAU,0EAAYA,OAAtB;AAO+B;AAGrC;;AA9BoC;AAAA;AAAA,iBAgC9B,0BAAiBC,WAAjB,EAAyC;AAC5C,gBAAIA,WAAW,CAACC,IAAZ,KAAqB,SAAzB,EAAoC;AAChC,qBAAO,YAAP;AACH;;AACD,gBAAID,WAAW,CAACC,IAAZ,KAAqB,YAAzB,EAAuC;AACnC,qBAAO,WAAP;AACH;;AACD,mBAAO,KAAKhB,SAAL,CAAeiB,OAAf,CAAuB,gBAAvB,CAAP;AACH;AAxCoC;AAAA;AAAA,iBA0C9B,mBAAUC,KAAV,EAA8B;AACjC,mBAAO,IAAI,mDAAJ,CAAcA,KAAK,IAAI,CAAvB,EAA0BC,KAA1B,CAAgC,GAAhC,EAAqCC,QAArC,EAAP;AACH;AA5CoC;AAAA;AAAA,iBA8C9B,kBAAM;AAAA;;AACT,iBAAKhB,WAAL,GAAmB,IAAnB;AACA,iBAAKiB,eAAL,GACKC,IADL,CAEQ,mEAAW,UAAAC,KAAK,EAAI;AAChB,oBAAI,CAACnB,WAAL,GAAmB,KAAnB;AACA,qBAAO,wDAAWmB,KAAX,CAAP;AACH,aAHD,CAFR,EAOKC,SAPL,CAOe,YAAM;AACb,oBAAI,CAACtB,SAAL,CAAeuB,IAAf;AACH,aATL;AAUH;AA1DoC;AAAA;AAAA,iBA4D9B,gCAAoB;AACvB,mBACI,KAAKX,OAAL,KAAiB,OAAjB,IACA,KAAKC,WAAL,CAAiBC,IAAjB,KAA0B,UAD1B,IAEA,CAAC,IAAD,EAAO,IAAP,EAAaU,QAAb,CAAsB,KAAKX,WAAL,CAAiBY,QAAjB,CAA0BC,IAAhD,CAHJ;AAKH;AAlEoC;AAAA;AAAA,iBAoE9B,6BAAiB;AACpB,mBAAO,KAAK7B,YAAL,CAAkB8B,iBAAlB,CAAoC,KAAKd,WAAzC,CAAP;AACH;AAtEoC;;AAAA;AAAA,QAAS,qGAAT,C;;;;gBAjBhC;;gBAUA;;gBAFA;;gBACA;;gBARA;;;;;;gBAkBJ;;;gBAEA;;;gBAEA;;;AANQpB,kCAA4B,6DAJxC,gEAAU;AACPmC,gBAAQ,EAAE,sBADH;AAEPC,gBAAQ,EAAR;AAFO,OAAV,CAIwC,GAA5BpC,4BAA4B,CAA5B","file":"default~admin-admin-module~deposit-deposit-module~discover-discover-module~organization-organization~bea567be-es5.js","sourcesContent":["export default \"<div class=\\\"modal-header\\\">\\n    <h5 class=\\\"modal-title\\\">{{ 'common.confirm' | translate }} {{ transaction.type }}</h5>\\n    <button type=\\\"button\\\" class=\\\"btn btn-round close close-modal\\\" (click)=\\\"modal.dismiss()\\\">&times;</button>\\n</div>\\n<div class=\\\"modal-body e2e-confirm-payment\\\">\\n    <ng-container *ngIf=\\\"!isSubmitted; else loader\\\">\\n        <div class=\\\"mb-2 text-center\\\">\\n            <span class=\\\"label label-success mb-1\\\">{{ buildActionLabel(transaction) }}</span>\\n            <h2 class=\\\"text-primary mb-0\\\">\\n                {{ calculateDeductableAmount(transaction) || '0.0' | amount: transaction.currency?.decimalPlaces }} {{ transaction.currency?.code }}\\n            </h2>\\n        </div>\\n        <transaction-flow [transaction]=\\\"transaction\\\"></transaction-flow>\\n        <table class=\\\"table table-borderless\\\">\\n            <tbody>\\n                <ng-container *ngIf=\\\"!isSgpmxMetalTransfer(); else metalTransferFees\\\">\\n                    <tr>\\n                        <th class=\\\"py-2 text-right font-weight-bold text-muted\\\">{{ 'common.service-fee' | translate }}</th>\\n                        <td class=\\\"py-2 text-right text-muted\\\">\\n                            <div>{{ calculateFee(transaction) | amount: transaction.currency?.decimalPlaces }} {{ transaction.currency?.code }}</div>\\n                            <small\\n                                >({{ transaction.fixedFee | amount }} {{ transaction.currency?.code }} +\\n                                {{ toPercent(transaction.relativeFee) | number }}%)</small\\n                            >\\n                        </td>\\n                    </tr>\\n                </ng-container>\\n                <ng-template #metalTransferFees>\\n                    <tr>\\n                        <th class=\\\"py-2 text-right font-weight-bold text-muted\\\">{{ 'common.service-fee' | translate }}</th>\\n                        <td class=\\\"py-2 text-right text-muted\\\">{{ calculateFeeInUsd() | async | amount }} USD</td>\\n                    </tr>\\n                </ng-template>\\n                <tr>\\n                    <th class=\\\"py-2 text-right font-weight-bold\\\">\\n                        <ng-container *ngIf=\\\"!transaction.card; else topupReceiver\\\">\\n                            {{ 'common.recipient' | translate }} {{ (transaction.id ? 'common.got' : 'common.gets') | translate }}\\n                        </ng-container>\\n                        <ng-template #topupReceiver> {{ 'common.card-loaded-with' | translate }} </ng-template>\\n                    </th>\\n                    <td class=\\\"py-2 text-right text-primary\\\">\\n                        {{ calculateCreditableAmount(transaction) | amount: transaction.currency?.decimalPlaces }} {{ transaction.currency?.code }}\\n                    </td>\\n                </tr>\\n            </tbody>\\n        </table>\\n        <form class=\\\"form-validation\\\" #passwordForm=\\\"ngForm\\\" (ngSubmit)=\\\"submit()\\\" novalidate>\\n            <div class=\\\"alert alert-danger\\\" *ngIf=\\\"alert\\\">\\n                {{ alert }}\\n            </div>\\n            <div class=\\\"form-group\\\" *ngIf=\\\"!showTwoFactorForm\\\">\\n                <div class=\\\"input-group input-group-lg\\\">\\n                    <span class=\\\"input-group-prepend\\\">\\n                        <span class=\\\"input-group-text\\\">\\n                            <fa-icon [icon]=\\\"faLockAlt\\\"></fa-icon>\\n                        </span>\\n                    </span>\\n                    <input\\n                        type=\\\"password\\\"\\n                        class=\\\"form-control\\\"\\n                        name=\\\"password\\\"\\n                        [placeholder]=\\\"'common.enter-your-password' | translate\\\"\\n                        [(ngModel)]=\\\"password\\\"\\n                        [focus]=\\\"true\\\"\\n                        required\\n                    />\\n                </div>\\n            </div>\\n            <div class=\\\"form-group\\\" *ngIf=\\\"showTwoFactorForm\\\">\\n                <div class=\\\"input-group input-group-lg\\\">\\n                    <span class=\\\"input-group-prepend\\\">\\n                        <span class=\\\"input-group-text\\\">\\n                            <fa-icon [icon]=\\\"faMobile\\\"></fa-icon>\\n                        </span>\\n                    </span>\\n                    <input\\n                        type=\\\"text\\\"\\n                        class=\\\"form-control\\\"\\n                        name=\\\"twoFactorCode\\\"\\n                        [placeholder]=\\\"'common.enter-2fa-code' | translate\\\"\\n                        number\\n                        [(ngModel)]=\\\"twoFactorCode\\\"\\n                        [focus]=\\\"true\\\"\\n                        required\\n                    />\\n                </div>\\n            </div>\\n            <button type=\\\"submit\\\" class=\\\"btn btn-lg btn-block btn-primary\\\" [disabled]=\\\"!passwordForm.valid || isLoading\\\">\\n                {{ 'common.confirm' | translate }}\\n            </button>\\n        </form>\\n    </ng-container>\\n    <ng-template #loader>\\n        <div class=\\\"circle-loader\\\" [ngClass]=\\\"{ 'load-complete': isCompleted }\\\">\\n            <div class=\\\"checkmark draw\\\"></div>\\n        </div>\\n        <h4 class=\\\"text-center text-primary\\\">\\n            <ng-container *ngIf=\\\"!isCompleted\\\">\\n                <ng-container [ngSwitch]=\\\"transaction.type\\\">\\n                    <ng-container *ngSwitchCase=\\\"'deposit'\\\">{{ 'common.creating-deposit-request' | translate }}</ng-container>\\n                    <ng-container *ngSwitchDefault>\\n                        <ng-container [ngSwitch]=\\\"transaction.method\\\">\\n                            <ng-container *ngSwitchCase=\\\"'card'\\\">{{ 'common.topping-up-card' | translate }}</ng-container>\\n                            <ng-container *ngSwitchDefault>{{ 'common.sending-payment' | translate }}</ng-container>\\n                        </ng-container>\\n                    </ng-container>\\n                </ng-container>\\n            </ng-container>\\n            <ng-container *ngIf=\\\"isCompleted\\\">\\n                <ng-container [ngSwitch]=\\\"transaction.type\\\">\\n                    <ng-container *ngSwitchCase=\\\"'deposit'\\\">{{ 'common.your-deposit-request-was-accepted' | translate }}</ng-container>\\n                    <ng-container *ngSwitchCase=\\\"'transfer'\\\">{{ 'common.your-payment-was-successful' | translate }}</ng-container>\\n                    <ng-container *ngSwitchDefault>{{ 'common.your-payment-has-been-accepted' | translate }}</ng-container>\\n                </ng-container>\\n            </ng-container>\\n        </h4>\\n        <button\\n            type=\\\"button\\\"\\n            class=\\\"btn btn-lg btn-block btn-primary-air\\\"\\n            (click)=\\\"onViewTransactions.emit()\\\"\\n            [disabled]=\\\"isSubmitted && !isCompleted\\\"\\n        >\\n            {{ (showInvoice ? 'common.view-proforma-invoice' : 'common.view-transaction') | translate }}\\n        </button>\\n    </ng-template>\\n</div>\\n\";","import { Component, EventEmitter, Input, Output } from '@angular/core'\nimport { faLockAlt, faMobile } from '@fortawesome/pro-light-svg-icons'\nimport { faEllipsisV } from '@fortawesome/pro-regular-svg-icons'\nimport { faShieldAlt } from '@fortawesome/pro-solid-svg-icons'\nimport { NgbActiveModal } from '@ng-bootstrap/ng-bootstrap'\nimport { TranslateService } from '@ngx-translate/core'\nimport BigNumber from 'bignumber.js'\nimport { Observable, throwError } from 'rxjs'\nimport { catchError } from 'rxjs/operators'\nimport { environment } from 'src/environments/environment'\nimport { Transaction } from '../../api-interfaces'\nimport { ConfirmPasswordModalComponent } from '../../security-check/confirm-password.modal'\nimport { SessionService, TokenScope } from '../../services/session.service'\nimport { SgpmxService } from '../../services/sgpmx.service'\nimport { TokenService } from '../../services/token.service'\nimport { calculateCreditableAmount, calculateDeductableAmount, calculateFee } from '../../transactions.mixins'\n\n@Component({\n    selector: 'payment-confirmation',\n    templateUrl: 'payment-confirmation.component.html',\n})\nexport class PaymentConfirmationComponent extends ConfirmPasswordModalComponent {\n    public scope = 'banking' as TokenScope\n    @Input()\n    public transaction: Transaction\n    @Output()\n    public readonly onConfirm = new EventEmitter<void | string>()\n    @Output()\n    public readonly onViewTransactions = new EventEmitter<void>()\n\n    public isSubmitted = false\n    public isCompleted = false\n    public showInvoice = false\n\n    public calculateFee = calculateFee\n    public calculateCreditableAmount = calculateCreditableAmount\n    public calculateDeductableAmount = calculateDeductableAmount\n    public faMobile = faMobile\n    public faLockAlt = faLockAlt\n    public faEllipsisV = faEllipsisV\n    public faShieldAlt = faShieldAlt\n    public appName = environment.appName\n\n    constructor(\n        modal: NgbActiveModal,\n        tokenService: TokenService,\n        session: SessionService,\n        private sgpmxService: SgpmxService,\n        public translate: TranslateService\n    ) {\n        super(modal, tokenService, session)\n    }\n\n    public buildActionLabel(transaction: Transaction): string {\n        if (transaction.type === 'deposit') {\n            return 'Requesting'\n        }\n        if (transaction.type === 'investment') {\n            return 'Investing'\n        }\n        return this.translate.instant('common.sending')\n    }\n\n    public toPercent(value: string | null): string {\n        return new BigNumber(value || 0).times(100).toString()\n    }\n\n    public submit(): void {\n        this.isSubmitted = true\n        this.grantTokenScope()\n            .pipe(\n                catchError(error => {\n                    this.isSubmitted = false\n                    return throwError(error)\n                })\n            )\n            .subscribe(() => {\n                this.onConfirm.emit()\n            })\n    }\n\n    public isSgpmxMetalTransfer(): boolean {\n        return (\n            this.appName === 'sgpmx' &&\n            this.transaction.type === 'transfer' &&\n            ['AU', 'AG'].includes(this.transaction.currency.code)\n        )\n    }\n\n    public calculateFeeInUsd(): Observable<string> {\n        return this.sgpmxService.calculateFeeInUsd(this.transaction)\n    }\n}\n"]}